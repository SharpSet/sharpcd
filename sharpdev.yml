version: 1.0
envfile: .env

values:
  SECRETD: '{\"secret\":\"$PASSD\"}'
  SECRET: '{\"secret\":\"$PASS\"}'
  sharpcd_internal: ./internal/sharpcd

setup: |
  go mod tidy
  go build -o ./internal/sharpcd ./src

scripts:
  server: |
    sharpdev kill
    sudo sharpcd_internal server > /dev/null 2>&1 &

  serveropen: |
    sharpdev kill
    sudo sharpcd_internal server

  default: |
    sharpdev server
    sharpdev client
    sharpdev client_test_different_url
    sharpdev client_test_password
    sharpdev kill

  kill: |
    sudo apt-get install -y lsof
    sudo lsof -ti :5666 | sudo xargs --no-run-if-empty kill -9

  shared: |
    sudo docker-compose -f "./internal/sharpcd-data/docker/external_task/docker-compose.yml" down
    $(sudo docker volume rm memes) > /dev/null 2>&1 || true
    $(sudo docker network rm memes) > /dev/null 2>&1 || true

  client: |
    sharpdev shared
    sharpcd_internal --secret $PASSD

  clientonly:
    sharpcd_internal --secret $PASSD

  client_test_different_url: |
    sharpdev shared
    sharpcd_internal --secret $PASSD --remotefile https://raw.githubusercontent.com/Sharpz7/sharpcd/dev/testing/configs/different_url/sharpcd.yml

  client_test_password: |
    sharpdev shared
    sharpcd_internal --remotefile https://raw.githubusercontent.com/Sharpz7/sharpcd/dev/testing/configs/passwords/sharpcd.yml

  trak: |
    sharpcd_internal --secret $PASSD trak $_ARG1 $_ARG2 $_ARG3

  trakone: |
    sharpdev trak job local $_ARG1

  trakall: |
    sharpdev trak alljobs local

  traklist: |
    sharpdev trak list local

  traklogs: |
    sharpdev trak logs local $_ARG1

  filter: sharpcd_internal addfilter https://raw.githubusercontent.com/Sharpz7/
  remove: sharpcd_internal removefilter https://raw.githubusercontent.com/Sharpz7/
  token: sharpcd_internal changetoken $_ARG1

  alljobsd: curl -k -X POST -d SECRETD https://localhost:5666/api/jobs
  alljobs: curl -k -X POST -d SECRET https://173.312.252.82:5666/api/jobs
  logsfeed: curl -k -X POST -d SECRETD https://localhost:5666/api/logsfeed/$_ARG1
  job: curl -k -X POST -d SECRETD https://localhost:5666/api/job/$_ARG1
  logs: curl -k -X POST -d SECRETD https://localhost:5666/api/logs/$_ARG1
  logsremote: curl -k -X POST -d SECRET https://mcaq.me:5666/api/logs/$_ARG1

  keygen: |
    sudo openssl req -x509 -nodes -days 730 -newkey rsa:2048 -keyout /home/coder/code-server/go/src/sharpCD/internal/sharpcd-data/private/server.key -out /home/coder/code-server/go/src/sharpCD/internal/sharpcd-data/private/server.crt -config /home/coder/code-server/go/src/sharpCD/testing/openssl.conf -extensions 'v3_req'



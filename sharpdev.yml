version: 1.0
envfile: .env

values:
  SECRETD: '{\"secret\":\"$PASSD\"}'
  SECRET: '{\"secret\":\"$PASS\"}'

scripts:
  build: |
    go build -o ./internal/sharpcd ./src

  sharpcd: |
    sharpdev build
    ./internal/sharpcd $_ARG1 $_ARG2 $_ARG3 $_ARG4 $_ARG5

  sharedserver: |
    sudo apt-get install -y lsof
    sudo kill $(sudo lsof -t -i:5666) > /dev/null 2>&1 || true
    sharpdev build

  server: |
    sharpdev sharedserver
    $(sudo ./internal/sharpcd server &) &

  serveropen: |
    sharpdev sharedserver
    sudo ./internal/sharpcd server

  kill: |
    sudo apt-get install -y lsof
    sudo kill $(sudo lsof -t -i:5666) > /dev/null 2>&1 || true

  shared: |
    sudo docker-compose -f "./internal/sharpcd-data/docker/external_task/docker-compose.yml" down
    $(sudo docker volume rm memes) > /dev/null 2>&1 || true
    $(sudo docker network rm memes) > /dev/null 2>&1 || true
    sharpdev build

  client: |
    sharpdev shared
    ./internal/sharpcd --secret $PASSD

  clientr: |
    sharpdev shared
    sharpdev sharpcd --secret $PASSD --remotefile https://raw.githubusercontent.com/Sharpz7/sharpcd/master/sharpcd.yml

  trak: |
    sharpdev build
    ./internal/sharpcd --secret $PASSD trak $_ARG1 $_ARG2 $_ARG3

  trakone: |
    sharpdev trak job local $_ARG1

  trakall: |
    sharpdev trak alljobs local

  traklist: |
    sharpdev trak list local

  filter: ./internal/sharpcd addfilter https://raw.githubusercontent.com/Sharpz7/
  remove: ./internal/sharpcd removefilter https://raw.githubusercontent.com/Sharpz7/
  token: ./internal/sharpcd changetoken $_ARG1

  alljobsd: curl -k -X POST -d SECRETD https://localhost:5666/api/jobs
  alljobs: curl -k -X POST -d SECRET https://173.212.252.82:5666/api/jobs
  logsfeed: curl -k -X POST -d SECRETD https://localhost:5666/api/logsfeed/$_ARG1
  job: curl -k -X POST -d SECRETD https://localhost:5666/api/job/$_ARG1
  logs: curl -k -X POST -d SECRETD https://localhost:5666/api/logs/$_ARG1
  logsremote: curl -k -X POST -d SECRET https://mcaq.me:5666/api/logs/$_ARG1

  keygen: |
    sudo openssl req -x509 -nodes -days 730 -newkey rsa:2048 -keyout /home/coder/code-server/go/src/sharpCD/internal/sharpcd-data/private/server.key -out /home/coder/code-server/go/src/sharpCD/internal/sharpcd-data/private/server.crt -config /home/coder/code-server/go/src/sharpCD/testing/openssl.conf -extensions 'v3_req'


